{% extends "base.html" %}

{% block title %}My Profile - InterviewAce{% endblock %}

{% block content %}
<div class="animated-bg"></div>

<div class="container" style="max-width: 1200px; margin: 2rem auto; padding: 0 2rem;">
    <!-- Profile Header -->
    <div style="text-align: center; margin-bottom: 3rem;">
        <h1 style="font-size: 2.5rem; font-weight: 700; color: #1a1a1a; margin-bottom: 0.5rem;">
            My <span style="background: linear-gradient(135deg, #22c55e, #16a34a); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Profile</span>
        </h1>
        <p style="color: #6b7280; font-size: 1.1rem;">Manage your account and preferences</p>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
        <!-- Left Sidebar - Profile Card -->
        <div>
            <div class="glass-card" style="padding: 2rem; text-align: center; position: sticky; top: 2rem;">
                <div style="width: 120px; height: 120px; margin: 0 auto 1.5rem; border-radius: 50%; background: linear-gradient(135deg, #22c55e, #16a34a); display: flex; align-items: center; justify-content: center; font-size: 4rem; box-shadow: 0 10px 30px rgba(34, 197, 94, 0.3); position: relative;">
                    <span id="avatarIcon">üë§</span>
                    <button onclick="document.getElementById('avatarUpload').click()" style="position: absolute; bottom: 0; right: 0; width: 40px; height: 40px; border-radius: 50%; background: white; border: 3px solid #22c55e; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.2rem;">
                        üì∑
                    </button>
                    <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                </div>
                <h3 id="displayName" style="font-size: 1.5rem; font-weight: 600; color: #1a1a1a; margin-bottom: 0.5rem;">Loading...</h3>
                <p id="displayEmail" style="color: #6b7280; margin-bottom: 1rem; font-size: 0.9rem;">email@example.com</p>
                <div style="display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1.5rem;">
                    <span id="authBadge" style="background: rgba(34, 197, 94, 0.1); color: #22c55e; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">üîê Local Account</span>
                    <span style="background: rgba(59, 130, 246, 0.1); color: #3b82f6; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">‚úÖ Verified</span>
                </div>
                <div style="border-top: 1px solid rgba(34, 197, 94, 0.1); padding-top: 1.5rem; margin-top: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                        <span style="color: #6b7280; font-size: 0.9rem;">Member Since</span>
                        <span id="memberSince" style="color: #1a1a1a; font-weight: 500; font-size: 0.9rem;">--</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="color: #6b7280; font-size: 0.9rem;">Total Interviews</span>
                        <span id="totalInterviews" style="color: #22c55e; font-weight: 600; font-size: 0.9rem;">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Content - Profile Details -->
        <div>
            <!-- Complete Profile Section -->
            <div class="glass-card" style="padding: 2rem; margin-bottom: 2rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                    <h3 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin: 0;">üìù Complete Your Profile</h3>
                    <span id="profileCompletion" style="background: rgba(34, 197, 94, 0.1); color: #22c55e; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">0% Complete</span>
                </div>
                <div style="width: 100%; height: 8px; background: rgba(34, 197, 94, 0.1); border-radius: 10px; margin-bottom: 2rem; overflow: hidden;">
                    <div id="profileProgress" style="width: 0%; height: 100%; background: linear-gradient(90deg, #22c55e, #16a34a); border-radius: 10px; transition: width 0.5s;"></div>
                </div>

                <form id="profileForm">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div class="form-group">
                            <label style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Full Name</label>
                            <input type="text" id="fullName" placeholder="Enter your full name" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div class="form-group">
                            <label style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Phone Number</label>
                            <input type="tel" id="phone" placeholder="+1 (555) 000-0000" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div class="form-group">
                            <label style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Current Role</label>
                            <input type="text" id="currentRole" placeholder="e.g., Software Engineer" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div class="form-group">
                            <label style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Experience Level</label>
                            <select id="experience" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                                <option value="">Select experience</option>
                                <option value="entry">Entry Level (0-2 years)</option>
                                <option value="mid">Mid Level (3-5 years)</option>
                                <option value="senior">Senior (6-10 years)</option>
                                <option value="expert">Expert (10+ years)</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Location</label>
                            <input type="text" id="location" placeholder="City, Country" style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 1rem;">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label style="display: block; color: #374151; font-weight: 500; margin-bottom: 0.5rem;">Bio</label>
                            <textarea id="bio" rows="3" placeholder="Tell us about yourself..." style="width: 100%; padding: 0.75rem; border: 1px solid #e5e7eb; border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; padding: 1rem; font-size: 1.1rem;">
                        üíæ Save Profile
                    </button>
                </form>
            </div>

            <!-- Skills Section -->
            <div class="glass-card" style="padding: 2rem; margin-bottom: 2rem;">
                <h3 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin-bottom: 1.5rem;">üéØ Skills & Interests</h3>
                <div style="display: flex; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1.5rem;" id="skillsList">
                    <span class="skill-tag">JavaScript</span>
                    <span class="skill-tag">Python</span>
                    <span class="skill-tag">React</span>
                    <button onclick="addSkill()" style="background: rgba(34, 197, 94, 0.1); color: #22c55e; border: 1px dashed #22c55e; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem; cursor: pointer;">+ Add Skill</button>
                </div>
            </div>

            <!-- Account Settings -->
            <div class="glass-card" style="padding: 2rem;">
                <h3 style="font-size: 1.3rem; font-weight: 600; color: #1a1a1a; margin-bottom: 1.5rem;">‚öôÔ∏è Account Settings</h3>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(34, 197, 94, 0.02); border-radius: 10px;">
                        <div>
                            <div style="font-weight: 500; color: #1a1a1a; margin-bottom: 0.25rem;">Email Notifications</div>
                            <div style="font-size: 0.85rem; color: #6b7280;">Receive updates about your interviews</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="emailNotif" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(34, 197, 94, 0.02); border-radius: 10px;">
                        <div>
                            <div style="font-weight: 500; color: #1a1a1a; margin-bottom: 0.25rem;">Performance Insights</div>
                            <div style="font-size: 0.85rem; color: #6b7280;">Get weekly performance reports</div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="insights" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <button onclick="changePassword()" style="width: 100%; padding: 1rem; background: #3b82f6; color: white; border: none; border-radius: 10px; font-size: 1rem; font-weight: 500; cursor: pointer; margin-top: 1rem;">
                        üîí Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.glass-card {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    border: 1px solid rgba(34, 197, 94, 0.1);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
}

.skill-tag {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 500;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 26px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: 0.4s;
    border-radius: 26px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: 0.4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #22c55e;
}

input:checked + .toggle-slider:before {
    transform: translateX(24px);
}

@media (max-width: 968px) {
    .container > div {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const user = Auth.getCurrentUser();
    if (!user) {
        window.location.href = '/login';
        return;
    }

    document.getElementById('displayEmail').textContent = user.email;
    document.getElementById('displayName').textContent = user.email.split('@')[0];
    document.getElementById('memberSince').textContent = 'Jan 2025';

    // Load profile data
    loadProfileData(user.id);

    // Profile form submission
    document.getElementById('profileForm').addEventListener('submit', function(e) {
        e.preventDefault();
        saveProfile();
    });

    // Update profile completion
    updateProfileCompletion();
});

async function loadProfileData(userId) {
    try {
        const response = await fetch(`/api/profile/history?user_id=${userId}`);
        const data = await response.json();
        if (data.success) {
            document.getElementById('totalInterviews').textContent = data.total_interviews;
        }
    } catch (error) {
        console.error('Error loading profile:', error);
    }
}

function updateProfileCompletion() {
    const fields = ['fullName', 'phone', 'currentRole', 'experience', 'location', 'bio'];
    const filled = fields.filter(id => document.getElementById(id).value.trim()).length;
    const percentage = Math.round((filled / fields.length) * 100);
    
    document.getElementById('profileCompletion').textContent = percentage + '% Complete';
    document.getElementById('profileProgress').style.width = percentage + '%';
}

document.querySelectorAll('#profileForm input, #profileForm select, #profileForm textarea').forEach(el => {
    el.addEventListener('input', updateProfileCompletion);
});

function saveProfile() {
    Toast.success('Profile updated successfully!');
}

function addSkill() {
    const skill = prompt('Enter skill name:');
    if (skill) {
        const tag = document.createElement('span');
        tag.className = 'skill-tag';
        tag.textContent = skill;
        document.getElementById('skillsList').insertBefore(tag, document.getElementById('skillsList').lastElementChild);
    }
}

function changePassword() {
    window.location.href = '/forgot-password';
}
</script>
{% endblock %}
