{% extends "base.html" %}

{% block title %}Results - AI Resume Mock Interviewer{% endblock %}

{% block content %}
<div class="animated-bg"></div>
<div class="results-container">
    {% if result_id %}
    <script>
        window.resultId = '{{ result_id }}';
    </script>
    {% endif %}
    <h1 style="text-align: center; color: #1a1a1a; margin-bottom: 3rem; font-size: 3rem; font-weight: 700;">Professional Interview <span style="color: #22c55e;">Performance Report</span></h1>
    
    <div class="score-card">
        <div class="score-header">
            <div class="score-main">
                <h2 style="position: relative; z-index: 2; margin-bottom: 0.5rem;">Your Performance Score</h2>
                <div class="score-number" id="scoreNumber">--</div>
                <p style="position: relative; z-index: 2; font-size: 1.2rem; margin-bottom: 1rem;">out of 100</p>
                <div class="score-grade" id="scoreGrade">Calculating...</div>
            </div>
            
            <div class="score-visual">
                <div class="progress-ring" style="position: relative; z-index: 2;">
                    <svg class="progress-ring" width="180" height="180">
                        <circle class="progress-ring-circle" />
                        <circle class="progress-ring-progress" id="progressCircle" />
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.3rem; font-weight: bold;" id="progressText">0%</div>
                </div>
            </div>
        </div>
        
        <div class="score-insights">
            <div class="insight-grid">
                <div class="insight-item">
                    <div class="insight-icon">üéØ</div>
                    <div class="insight-content">
                        <div class="insight-title">Accuracy</div>
                        <div class="insight-value" id="accuracyInsight">--</div>
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">‚ö°</div>
                    <div class="insight-content">
                        <div class="insight-title">Speed</div>
                        <div class="insight-value" id="speedInsight">Optimal</div>
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">üìà</div>
                    <div class="insight-content">
                        <div class="insight-title">Trend</div>
                        <div class="insight-value" id="trendInsight">Improving</div>
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">üèÜ</div>
                    <div class="insight-content">
                        <div class="insight-title">Ranking</div>
                        <div class="insight-value" id="rankingInsight">--</div>
                    </div>
                </div>
            </div>
            
            <div class="score-breakdown">
                <h4 style="color: #1a1a1a; margin-bottom: 1rem; font-size: 1.1rem;">Performance Breakdown</h4>
                <div class="breakdown-item">
                    <span>Technical Knowledge</span>
                    <div class="breakdown-bar">
                        <div class="breakdown-fill" id="technicalFill" style="width: 0%;"></div>
                    </div>
                    <span id="technicalScore">--</span>
                </div>
                <div class="breakdown-item">
                    <span>Communication</span>
                    <div class="breakdown-bar">
                        <div class="breakdown-fill" id="communicationFill" style="width: 0%;"></div>
                    </div>
                    <span id="communicationScore">--</span>
                </div>
                <div class="breakdown-item">
                    <span>Problem Solving</span>
                    <div class="breakdown-bar">
                        <div class="breakdown-fill" id="problemSolvingFill" style="width: 0%;"></div>
                    </div>
                    <span id="problemSolvingScore">--</span>
                </div>
            </div>
            
            <div class="quick-tips">
                <h4 style="color: #1a1a1a; margin-bottom: 1rem; font-size: 1.1rem;">üí° Quick Improvement Tips</h4>
                <div class="tips-list" id="quickTips">
                    <div class="tip-item">Loading personalized tips...</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="analytics-compact" style="--delay: 0.2s;">
        <h3 style="color: #1a1a1a; margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;">üìä Performance <span style="color: #22c55e;">Analytics</span></h3>
        <div class="analytics-grid">
            <div class="analytics-stats">
                <div class="stat-row">
                    <div class="stat-compact">
                        <span class="stat-number" id="correctAnswers">0</span>
                        <span class="stat-label">Correct</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-number" id="accuracy">0%</span>
                        <span class="stat-label">Accuracy</span>
                    </div>
                    <div class="stat-compact">
                        <span class="stat-number" id="skillLevel">--</span>
                        <span class="stat-label">Level</span>
                    </div>
                </div>
            </div>
            <div class="chart-compact">
                <canvas id="performanceChart" class="chart-canvas"></canvas>
            </div>
        </div>
    </div>
    
    <div class="comparison-card" style="--delay: 0.3s;">
        <h3 style="color: #1a1a1a; margin-bottom: 2rem; font-size: 1.8rem; font-weight: 600;">üìà Performance <span style="color: #22c55e;">Benchmarking</span></h3>
        <div class="comparison-grid">
            <div class="comparison-item">
                <div class="comparison-header">
                    <span class="comparison-title">Industry Average</span>
                    <span class="comparison-score">65%</span>
                </div>
                <div class="comparison-bar">
                    <div class="comparison-fill" style="width: 65%; background: #94a3b8;"></div>
                </div>
            </div>
            <div class="comparison-item">
                <div class="comparison-header">
                    <span class="comparison-title">Your Performance</span>
                    <span class="comparison-score" id="yourScore">--</span>
                </div>
                <div class="comparison-bar">
                    <div class="comparison-fill" id="yourScoreFill" style="width: 0%; background: #22c55e;"></div>
                </div>
            </div>
            <div class="comparison-item">
                <div class="comparison-header">
                    <span class="comparison-title">Top 10% Performers</span>
                    <span class="comparison-score">90%</span>
                </div>
                <div class="comparison-bar">
                    <div class="comparison-fill" style="width: 90%; background: #f59e0b;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="feedback-card" style="--delay: 0.4s;">
        <h3 style="color: #1a1a1a; margin-bottom: 1.5rem; font-size: 1.8rem; font-weight: 600;">üìà Professional <span style="color: #22c55e;">Performance Analysis</span></h3>
        <div class="feedback-grid">
            <div class="feedback-section">
                <h4 style="color: #22c55e; margin-bottom: 1rem; font-size: 1.2rem;">üéØ Strengths Identified</h4>
                <ul id="strengthsList" style="color: #4a5568; line-height: 1.6;">
                    <li>Loading strengths analysis...</li>
                </ul>
            </div>
            <div class="feedback-section">
                <h4 style="color: #f59e0b; margin-bottom: 1rem; font-size: 1.2rem;">üí° Growth Opportunities</h4>
                <ul id="improvementsList" style="color: #4a5568; line-height: 1.6;">
                    <li>Loading improvement areas...</li>
                </ul>
            </div>
        </div>
        <div class="detailed-feedback">
            <h4 style="color: #1a1a1a; margin: 2rem 0 1rem 0; font-size: 1.3rem; font-weight: 600;">üìù Comprehensive Assessment</h4>
            <p id="feedbackText" style="color: #4a5568; font-size: 1.1rem; line-height: 1.7; background: rgba(34, 197, 94, 0.05); padding: 1.5rem; border-radius: 10px; border-left: 4px solid #22c55e;">Loading comprehensive feedback analysis...</p>
        </div>
    </div>
    
    <div class="qa-review-card" style="--delay: 0.6s;">
        <h3 style="color: #1a1a1a; margin-bottom: 2rem; font-size: 1.8rem; font-weight: 600;">üìù Detailed <span style="color: #22c55e;">Question & Answer Review</span></h3>
        <div class="qa-summary">
            <div class="qa-summary-item">
                <span class="qa-summary-number" id="correctCount">0</span>
                <span class="qa-summary-label">Correct</span>
            </div>
            <div class="qa-summary-item">
                <span class="qa-summary-number" id="partialCount">0</span>
                <span class="qa-summary-label">Partial</span>
            </div>
            <div class="qa-summary-item">
                <span class="qa-summary-number" id="incorrectCount">0</span>
                <span class="qa-summary-label">Incorrect</span>
            </div>
        </div>
        <div id="qaReview">
            <!-- Q&A review will be loaded here -->
        </div>
    </div>
    
    <div class="companies-card" style="--delay: 0.8s;">
        <h3 style="color: #1a1a1a; margin-bottom: 1.5rem; font-size: 1.8rem; font-weight: 600;">üè¢ Recommended <span style="color: #22c55e;">Career Opportunities</span></h3>
        <p style="color: #4a5568; margin-bottom: 2rem; font-size: 1.1rem;">Based on your professional performance and skill assessment, these companies align with your current capabilities and career trajectory:</p>
        <div class="companies-list" id="companiesList">
            <!-- Companies will be loaded here -->
        </div>
    </div>
    
    <div style="text-align: center; margin-top: 3rem; display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap;">
        <a href="/start-interview" class="btn btn-primary">Take Another Interview</a>
        <button id="viewHistoryBtn" class="btn" style="background: #3b82f6; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; cursor: pointer;">üìä View History</button>
        <a href="/" class="btn btn-secondary">Back to Home</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/results.js') }}"></script>
<script>
// View History button functionality
document.addEventListener('DOMContentLoaded', function() {
    const viewHistoryBtn = document.getElementById('viewHistoryBtn');
    
    viewHistoryBtn.addEventListener('click', function() {
        const user = JSON.parse(localStorage.getItem('user') || 'null');
        
        if (!user || !user.access_token) {
            // Show login modal
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: flex; align-items: center; justify-content: center;">
                    <div style="background: white; padding: 2rem; border-radius: 15px; text-align: center; max-width: 400px; margin: 1rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîê</div>
                        <h3 style="margin-bottom: 1rem;">Login Required</h3>
                        <p style="color: #6b7280; margin-bottom: 2rem;">Please login to view your interview history</p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <a href="/login" style="background: #22c55e; color: white; text-decoration: none; padding: 0.75rem 1.5rem; border-radius: 8px;">Login</a>
                            <button onclick="this.closest('div').parentElement.parentElement.remove()" style="background: #6b7280; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer;">Cancel</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        } else {
            window.location.href = '/history';
        }
    });
});
</script>
{% endblock %}